#!/bin/bash

# ==================================================================================================
# Script lancant la forcant le plantage de mallocs.
# Usage:
#   -> ./test_malloc.sh <path_to_program>
# ==================================================================================================
 
# ==================================================================================================
# TODO
# - [ ] Encapsuler les listes d'emojis pour limiter le nombre de var-env definie qd source
# - [ ] version classic de exec_with_loading adapte a cette nouvelle fonction
# - [ ] version qui affiche un texte, puis le loading pendant chargement then clear
# ==================================================================================================
 
# =[ VARIABLES ]====================================================================================
# -[ LISTES ]---------------------------------------------------------------------------------------
# EMOJIS
hour=( 'üïõ' 'üïê' 'üïë' 'üïí' 'üïì' 'üïî' 'üïï' 'üïñ' 'üïó' 'üïò' 'üïô' 'üïö')
earth=( üåç üåé üåè )
moon=( üåë üåí üåì üåî üåï üåñ üåó üåò )
arrow=( '‚Üë' '‚Üó' '‚Üí' '‚Üò' '‚Üì' '‚Üô' '‚Üê' '‚Üñ')
cym=( '‚äè' '‚äì' '‚äê' '‚äî')
line=( '‚ò∞' '‚ò±' '‚ò≥' '‚ò∑' '‚ò∂' '‚ò¥')
dots_wave=( ‚†Å ‚†Ç ‚†Ñ ‚°Ä ‚¢Ä ‚†† ‚†ê ‚†à )
old=( '‚Äî' "\\" '|' '/' )
tete=( "(-_-)" "(o_o)" "(O_O)" "(o_o)" "(-_-)")
d1=( '‚£æ' '‚£Ω' '‚£ª' '‚¢ø' '‚°ø' '‚£ü' '‚£Ø' '‚£∑' )
d2=( '‚†ã' '‚†ô' '‚†π' '‚†∏' '‚†º' '‚†¥' '‚†¶' '‚†ß' '‚†á' '‚†è' )
d3=( '‚†ã' '‚†ô' '‚†ö' '‚†û' '‚†ñ' '‚†¶' '‚†¥' '‚†≤' '‚†≥' '‚†ì' )
d9=(  '‚¢π' '‚¢∫' '‚¢º' '‚£∏' '‚£á' '‚°ß' '‚°ó' '‚°è' )
vblock=( ‚ñÅ ‚ñÇ ‚ñÉ ‚ñÑ ‚ñÖ ‚ñÜ ‚ñá ‚ñà ‚ñà ‚ñá ‚ñÜ ‚ñÖ ‚ñÑ ‚ñÉ ‚ñÇ ‚ñÅ )
hblock=( ‚ñè ‚ñé ‚ñç ‚ñå ‚ñã ‚ñä ‚ñâ ‚ñâ ‚ñä ‚ñã ‚ñå ‚ñç ‚ñé ‚ñè )
quarter=( ‚ññ ‚ñò ‚ñù ‚ñó )
triangle=( ‚ó¢ ‚ó£ ‚ó§ ‚ó•)
semi_circle=( ‚óê ‚óì ‚óë ‚óí )
firework=( '‚¢Ä' '‚††' '‚†ê' '‚†à' '*' '*' '¬†' )
arrow=( ‚ñπ‚ñπ‚ñπ‚ñπ‚ñπ ‚ñ∏‚ñπ‚ñπ‚ñπ‚ñπ ‚ñπ‚ñ∏‚ñπ‚ñπ‚ñπ ‚ñπ‚ñπ‚ñ∏‚ñπ‚ñπ ‚ñπ‚ñπ‚ñπ‚ñ∏‚ñπ ‚ñπ‚ñπ‚ñπ‚ñπ‚ñ∏ ‚ñπ‚ñπ‚ñπ‚ñπ‚ñπ ‚ñπ‚ñπ‚ñπ‚ñπ‚ñπ ‚ñπ‚ñπ‚ñπ‚ñπ‚ñπ ‚ñπ‚ñπ‚ñπ‚ñπ‚ñπ ‚ñπ‚ñπ‚ñπ‚ñπ‚ñπ ‚ñπ‚ñπ‚ñπ‚ñπ‚ñπ ‚ñπ‚ñπ‚ñπ‚ñπ‚ñπ )
big_ball=( '(‚óè¬†¬†¬†¬†¬†)' '(¬†‚óè¬†¬†¬†¬†)' '(¬†¬†‚óè¬†¬†¬†)' '(¬†¬†¬†‚óè¬†¬†)' '(¬†¬†¬†¬†‚óè¬†)' '(¬†¬†¬†¬†¬†‚óè)' '(¬†¬†¬†¬†‚óè¬†)' '(¬†¬†¬†‚óè¬†¬†)' '(¬†¬†‚óè¬†¬†¬†)' '(¬†‚óè¬†¬†¬†¬†)' )
dot=( ‚àô‚àô‚àô ‚óè‚àô‚àô ‚àô‚óè‚àô ‚àô‚àô‚óè )
metro=( ‚ñ∞‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ± ‚ñ∞‚ñ∞‚ñ±‚ñ±‚ñ±‚ñ±‚ñ± ‚ñ∞‚ñ∞‚ñ∞‚ñ±‚ñ±‚ñ±‚ñ± ‚ñ±‚ñ∞‚ñ∞‚ñ∞‚ñ±‚ñ±‚ñ± ‚ñ±‚ñ±‚ñ∞‚ñ∞‚ñ∞‚ñ±‚ñ± ‚ñ±‚ñ±‚ñ±‚ñ∞‚ñ∞‚ñ∞‚ñ± ‚ñ±‚ñ±‚ñ±‚ñ±‚ñ∞‚ñ∞‚ñ∞ ‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ∞‚ñ∞ ‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ∞ ‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ± ‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ± ‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ± ‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ±‚ñ± )
pong=( '‚ñê‚†Ç¬†¬†¬†¬†¬†¬†¬†‚ñå' '‚ñê‚†à¬†¬†¬†¬†¬†¬†¬†‚ñå' '‚ñê¬†‚†Ç¬†¬†¬†¬†¬†¬†‚ñå' '‚ñê¬†‚††¬†¬†¬†¬†¬†¬†‚ñå' '‚ñê¬†¬†‚°Ä¬†¬†¬†¬†¬†‚ñå' '‚ñê¬†¬†‚††¬†¬†¬†¬†¬†‚ñå' '‚ñê¬†¬†¬†‚†Ç¬†¬†¬†¬†‚ñå' '‚ñê¬†¬†¬†‚†à¬†¬†¬†¬†‚ñå' '‚ñê¬†¬†¬†¬†‚†Ç¬†¬†¬†‚ñå' '‚ñê¬†¬†¬†¬†‚††¬†¬†¬†‚ñå' '‚ñê¬†¬†¬†¬†¬†‚°Ä¬†¬†‚ñå' '‚ñê¬†¬†¬†¬†¬†‚††¬†¬†‚ñå' '‚ñê¬†¬†¬†¬†¬†¬†‚†Ç¬†‚ñå' '‚ñê¬†¬†¬†¬†¬†¬†‚†à¬†‚ñå' '‚ñê¬†¬†¬†¬†¬†¬†¬†‚†Ç‚ñå' '‚ñê¬†¬†¬†¬†¬†¬†¬†‚††‚ñå' '‚ñê¬†¬†¬†¬†¬†¬†¬†‚°Ä‚ñå' '‚ñê¬†¬†¬†¬†¬†¬†‚††¬†‚ñå' '‚ñê¬†¬†¬†¬†¬†¬†‚†Ç¬†‚ñå' '‚ñê¬†¬†¬†¬†¬†‚†à¬†¬†‚ñå' '‚ñê¬†¬†¬†¬†¬†‚†Ç¬†¬†‚ñå' '‚ñê¬†¬†¬†¬†‚††¬†¬†¬†‚ñå' '‚ñê¬†¬†¬†¬†‚°Ä¬†¬†¬†‚ñå' '‚ñê¬†¬†¬†‚††¬†¬†¬†¬†‚ñå' '‚ñê¬†¬†¬†‚†Ç¬†¬†¬†¬†‚ñå' '‚ñê¬†¬†‚†à¬†¬†¬†¬†¬†‚ñå' '‚ñê¬†¬†‚†Ç¬†¬†¬†¬†¬†‚ñå' '‚ñê¬†‚††¬†¬†¬†¬†¬†¬†‚ñå' '‚ñê¬†‚°Ä¬†¬†¬†¬†¬†¬†‚ñå' '‚ñê‚††¬†¬†¬†¬†¬†¬†¬†‚ñå' )
bar=( '‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí' '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà')

# =[ FONCTIONS SCRIPTS ]============================================================================
# Fonction pour afficher l'animation de chargement
loading_animation()
{
    local pid=$1
    local delay=$2
    shift 2
    local frames=("${@}")

    while kill -0 $pid 2>/dev/null; do  # Continue tant que le processus est en cours
        for frame in "${frames[@]}"; do
            printf "$R2\r$frame"
            sleep $delay
        done
    done
    printf "\r"  # Efface l'animation √† la fin
}

# Fonction pour ex√©cuter une commande avec animation
run_with_loading()
{
    $1 &  # Ex√©cute la commande en arri√®re-plan
    local pid=$!
    loading_animation ${pid} 0.2 ${hour[@]}
    wait $pid
}
